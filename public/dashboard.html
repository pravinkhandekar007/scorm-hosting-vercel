<div>
  <h2>Welcome, <span id="user-name"></span></h2>
  <p>Your role is: <span id="user-role"></span></p>
  <div id="upgrade-role-section" style="display:none;">
    <button id="upgrade-role-btn">Become Course Owner</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabase = supabase.createClient('https://mfooewemvofleynanjkb.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mb29ld2Vtdm9mbGV5bmFuamtiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyOTUwMjYsImV4cCI6MjA3NDg3MTAyNn0.EFvtSe-k-SPDCf1-1py6ev7nBLDJFCrNgZ95_c29_ZY');

  async function loadUser() {
    const { data: { user }} = await supabase.auth.getUser();
    if (!user) {
      window.location.href = "/login.html";
      return;
    }

    const { data: profile, error } = await supabase
      .from('profiles')
      .select('full_name, role')
      .eq('user_id', user.id)
      .single();

    if (error) {
      alert("Failed to load profile: " + error.message);
      return;
    }

    document.getElementById('user-name').textContent = profile.full_name;
    document.getElementById('user-role').textContent = profile.role;

    if (profile.role === 'learner') {
      document.getElementById('upgrade-role-section').style.display = 'block';
      document.getElementById('upgrade-role-btn').addEventListener('click', upgradeRole);
    }
  }

  async function upgradeRole() {
    const { data: { user }} = await supabase.auth.getUser();

    const { error } = await supabase
      .from('profiles')
      .update({ role: 'owner' })
      .eq('user_id', user.id);

    if (error) {
      alert("Failed to upgrade: " + error.message);
      return;
    }

    alert("Role upgraded to owner!");
    window.location.reload();
  }

  loadUser();
</script>
