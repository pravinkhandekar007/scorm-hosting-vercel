<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My SCORM Courses</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.6.0/dist/umd/supabase.min.js"></script>
</head>
<body>
  <h2>My Uploaded Courses</h2>
  <div id="courses">Loading...</div>

  <script>
    const SUPABASE_URL = 'https://mfooewemvofleynanjkb.supabase.co';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function showCourses() {
      const { data: { session } } = await supabase.auth.getSession();
      const container = document.getElementById('courses');

      if (!session) {
        container.innerHTML = 'Please <a href="login.html">log in</a> to view your courses.';
        return;
      }

      const res = await fetch(`/api/list-courses`, {
        headers: { "Authorization": `Bearer ${session.access_token}` }
      });
      const json = await res.json();
      if (json.error) {
        container.textContent = 'Error: ' + json.error;
        return;
      }

      if (json.courses.length === 0) {
        container.textContent = 'No courses uploaded yet.';
        return;
      }

      container.innerHTML = json.courses.map(c => `
        <div>
          <strong>${c.title}</strong>
          <a href="player.html?course=${encodeURIComponent(c.course_slug)}" target="_blank">Launch</a>
        </div>
      `).join('');
    }

    document.addEventListener('DOMContentLoaded', showCourses);
  </script>
</body>
</html>
